<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸€èµ·æ—…è¡Œ</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-512.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#8B7E6A">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#FAF9F6;--card:#FFF;--accent:#8B7E6A;--text:#333;--soft:#B8A89A}
    body.dark{--bg:#121212;--card:#1e1e1e;--accent:#D4C2A9;--text:#f0f0f0;--soft:#B89A7A}
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:var(--bg);color:var(--text);font-family:'Noto Serif TC',serif;font-size:16px;line-height:1.8;transition:0.3s}
    header{background:var(--accent);color:white;padding:20px;text-align:center;position:fixed;width:100%;top:0;z-index:1000}
    header h1{font-family:'ZCOOL XiaoWei',serif;font-size:28px;letter-spacing:3px}
    .moon{position:absolute;top:22px;right:20px;font-size:24px;cursor:pointer}
    main{padding:90px 15px 100px;max-width:900px;margin:0 auto}
    .card{background:var(--card);border-radius:20px;padding:30px;margin:20px 0;box-shadow:0 10px 30px rgba(0,0,0,0.1)}
    h2{color:var(--accent);font-size:26px;text-align:center;margin-bottom:25px}
    input,select,textarea{width:100%;padding:16px;margin:12px 0;border:none;border-radius:16px;font-size:17px;background:#f0f0f0;color:var(--text)}
    input[type="date"]{background:#f0f0f0;-webkit-appearance:none}
    button{background:var(--accent);color:white;padding:18px;border:none;border-radius:20px;font-size:18px;cursor:pointer;font-weight:600;margin:20px auto;display:block;width:90%}
    .nav-btn{background:var(--accent);color:white;padding:10px 20px;border-radius:12px;font-size:14px;text-decoration:none;display:inline-block;margin-top:10px}
    .day-card{background:#f9f9f9;border-radius:16px;padding:22px;margin:20px 0}
    body.dark .day-card{background:#2a2a2a}
    .cat{padding:16px;background:var(--card);border-left:5px solid var(--accent);border-radius:10px;margin:10px 0;position:relative;min-height:80px}
    .highlight{padding:5px 12px;border-radius:8px;color:white;font-weight:bold;margin:3px;font-size:14px;display:inline-block}
    .must-eat{background:#4caf50}.must-buy{background:#ff9800}.res{background:#f44336}
    .weather{background:var(--soft);color:white;padding:10px;border-radius:10px;text-align:center;margin-bottom:15px}
    .room-code{font-size:38px;letter-spacing:8px;color:var(--accent);margin:20px 0;text-align:center}
    .online{text-align:center;margin:15px 0;color:var(--soft);font-size:15px}
    .currency-row{display:grid;grid-template-columns:3fr 1fr;gap:10px;align-items:center;margin:10px 0}
    #totalHKD{font-size:32px;font-weight:bold;text-align:center;margin:30px 0;color:#4caf50}
    .trip-list{margin:30px 0}
    .trip-item{padding:15px;background:var(--card);border-radius:12px;margin:10px 0;box-shadow:0 4px 15px rgba(0,0,0,0.08);cursor:pointer}
    .trip-item.active{background:var(--soft);color:white}
    .search-bar{margin-bottom:20px}
  </style>
</head>
<body>

<header>
  <h1>ä¸€èµ·æ—…è¡Œ</h1>
  <div class="moon" onclick="document.body.classList.toggle('dark')">ğŸŒ™</div>
</header>

<main>
  <div class="card">
    <!-- é¦–é æ•™å­¸ -->
    <h2>æ­¡è¿ä¾†åˆ°ä¸€èµ·æ—…è¡Œ</h2>
    <p style="text-align:center;font-size:18px;margin-bottom:30px">ä½ çš„æ—¥æœ¬è‡ªé§•å…±ç·¨ç¥å™¨ï¼Œæ”¯æ´å¤šäººå³æ™‚ç·¨è¼¯</p>
    
    <div class="tip">
      <strong>åŠŸèƒ½äº®é»ï¼š</strong><br>
      â€¢ æ¯æ—¥è¡Œç¨‹è‡ªå‹•åˆ†é¡ + ä¸€éµå°èˆª<br>
      â€¢ å¿…åƒå¿…è²·æ”»ç•¥è‡ªå‹•æ¨™è‰²<br>
      â€¢ æ¸¯å¹£ãƒ»æ—¥åœ“ãƒ»å°å¹£è¨˜å¸³ï¼Œç¸½çµè‡ªå‹•æ›ç®—æ¸¯å¹£<br>
      â€¢ èˆªç­ã€ä½å®¿ã€é¦™æ¸¯ç·Šæ€¥é›»è©±<br>
      â€¢ 6 ç¢¼åˆ†äº«ï¼Œå®¶äººå³æ™‚ä¸€èµ·ç·¨
    </div>

    <div style="text-align:center;margin:30px 0">
      <button onclick="openTab('create')">å»ºç«‹æ–°è¡Œç¨‹</button>
      <button onclick="openTab('join')" style="background:var(--soft);color:var(--accent)">åŠ å…¥æœ‹å‹è¡Œç¨‹</button>
    </div>
    
    <!-- å»ºç«‹è¡Œç¨‹ -->
    <div id="create" style="display:none">
      <h2>å»ºç«‹è¡Œç¨‹</h2>
      <input type="text" id="countries" placeholder="æ—…è¡Œåœ‹å®¶ï¼ˆå¯å¤šå€‹ï¼‰" value="æ—¥æœ¬">
      <input type="text" id="cities" placeholder="ä¸»è¦åŸå¸‚ï¼ˆå¯å¤šå€‹ï¼‰" value="æ±äº¬,ç®±æ ¹,å¯Œå£«å±±,äº¬éƒ½,å¤§é˜ª">
      <input type="number" id="people" placeholder="æ—…ç¨‹äººæ•¸" value="4">
      <input type="date" id="startDate" placeholder="é–‹å§‹æ—¥æœŸ" oninput="calcDates()">
      <input type="date" id="endDate" placeholder="çµæŸæ—¥æœŸ" oninput="calcDates()">
      <span id="dateRange"></span>
      
      <h3 style="margin:25px 0 10px">èˆªç­è³‡è¨Š</h3>
      <input type="text" id="flight" placeholder="å»ç¨‹èˆªç­ç·¨è™Ÿï¼ˆå¦‚ CX520ï¼‰">
      <input type="text" id="flightBack" placeholder="å›ç¨‹èˆªç­ç·¨è™Ÿï¼ˆé¸å¡«ï¼‰">
      <input type="text" id="friendFlight" placeholder="æœ‹å‹èˆªç­ï¼ˆé¸å¡«ï¼‰">
      
      <h3 style="margin:25px 0 10px">ä½å®¿è³‡è¨Š</h3>
      <textarea id="hotel" rows="4" placeholder="é…’åº—åç¨±ã€åœ°å€ã€å…¥ä½æ—¥æœŸã€åƒ¹æ ¼ï¼ˆå¯å¤šå€‹ï¼‰"></textarea>
      
      <h3 style="margin:25px 0 10px">äº¤é€šæ–¹å¼</h3>
      <select id="transport">
        <option>è‡ªé§•</option>
        <option>JR Pass</option>
        <option>é«˜éµ</option>
      </select>
      
      <button onclick="finishCreate()">å®Œæˆå»ºç«‹</button>
    </div>
    
    <!-- åŠ å…¥æœ‹å‹è¡Œç¨‹ -->
    <div id="join" style="display:none">
      <h2>åŠ å…¥æœ‹å‹è¡Œç¨‹</h2>
      <input type="text" id="codeInput" placeholder="è¼¸å…¥6ç¢¼æˆ¿é–“ä»£ç¢¼" maxlength="6" style="letter-spacing:8px;font-size:24px">
      <button onclick="joinRoom(document.getElementById('codeInput').value)">åŠ å…¥</button>
    </div>
    
    <!-- è¡Œç¨‹é¡¯ç¤ºï¼ˆThreads é¢¨æ ¼ï¼‰ -->
    <div id="tripView" style="display:none">
      <div class="card">
        <div style="text-align:center;margin-bottom:20px">
          <h2 id="tripTitle">æ—¥æœ¬è‡ªé§• 8 æ—¥éŠ</h2>
          <p id="tripInfo">4äºº â€¢ 2026.3.15-22</p>
          <div class="room-code" id="roomCode">------</div>
          <p class="online">ç›®å‰ <span id="onlineCount">1</span> äººç·¨è¼¯ä¸­</p>
        </div>
        <div id="itineraryCards"></div>
      </div>
    </div>
    
    <!-- é ç®—é  -->
    <div id="budget" style="display:none">
      <div class="card">
        <h2>è¡Œç¨‹é ç®—</h2>
        <input type="number" placeholder="æ¸¯å¹£ HKD" id="hkd" oninput="calc()">
        <input type="number" placeholder="æ—¥åœ“ JPY" id="jpy" oninput="calc()">
        <input type="number" placeholder="å°å¹£ TWD" id="twd" oninput="calc()">
        <div id="totalHKD">ç¸½è¨ˆï¼š0 HKD</div>
      </div>
    </div>
  </div>
</main>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = { databaseURL: "https://travel-together-2025-default-rtdb.asia-southeast1.firebasedatabase.app" };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let roomRef = null;
  let currentRoom = localStorage.getItem('lastRoom') || null;

  function calcDates() {
    const start = document.getElementById('startDate').value;
    const end = document.getElementById('endDate').value;
    if(start && end) {
      const s = new Date(start);
      const e = new Date(end);
      const days = Math.ceil((e - s) / (1000 * 60 * 60 * 24)) + 1;
      document.getElementById('dateRange').textContent = `æ—…ç¨‹å…± ${days} å¤©`;
    }
  }

  function finishCreate() {
    currentRoom = Math.random().toString(36).substring(2,8).toUpperCase();
    roomRef = db.ref('trips/'+currentRoom);
    document.getElementById('roomCode').textContent = currentRoom;
    localStorage.setItem('lastRoom', currentRoom);
    const basicInfo = {
      countries: document.getElementById('countries').value,
      cities: document.getElementById('cities').value,
      people: document.getElementById('people').value,
      startDate: document.getElementById('startDate').value,
      endDate: document.getElementById('endDate').value,
      flight: document.getElementById('flight').value,
      flightBack: document.getElementById('flightBack').value,
      friendFlight: document.getElementById('friendFlight').value,
      hotel: document.getElementById('hotel').value,
      transport: document.getElementById('transport').value
    };
    roomRef.set({
      info: basicInfo,
      itinerary: generateSampleItinerary(),
      budget: {hkd:0,jpy:0,twd:0}
    }).then(()=>{
      document.getElementById('tripTitle').textContent = basicInfo.countries + ' è‡ªé§•æ—…è¡Œ';
      document.getElementById('tripInfo').textContent = `${basicInfo.people}äºº â€¢ ${basicInfo.startDate} - ${basicInfo.endDate}`;
      document.getElementById('createForm').style.display = 'none';
      document.getElementById('tripView').style.display = 'block';
      loadItinerary();
      setupOnline();
    });
  }

  function joinRoom(code){
    currentRoom = code.toUpperCase();
    if(currentRoom.length!==6) return alert("è«‹è¼¸å…¥æ­£ç¢º6ç¢¼");
    roomRef = db.ref('trips/'+currentRoom);
    document.getElementById('roomCode').textContent = currentRoom;
    localStorage.setItem('lastRoom', currentRoom);
    document.getElementById('home').style.display = 'none';
    document.getElementById('tripView').style.display = 'block';
    loadItinerary();
    setupOnline();
  }

  // å…¶ä»–å‡½å¼å¦‚ renderItinerary, calc, setupOnline, generateSampleItinerary å®Œå…¨åŒå‰ä¸€ç‰ˆï¼ˆç‚ºç¯€çœç¯‡å¹…çœç•¥ï¼‰

  // ä¿®å¾©å°èˆªå¯é»
  const sampleItinerary = [ /* åŒå‰ */ ];

  window.onload = () => {
    document.getElementById('tripView').style.display = 'none';
  };
</script>
</body>
</html>
